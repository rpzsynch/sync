<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Synchroniser POV</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background-color: #000;
      color: #eee;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 20px;
    }

    .videos {
      display: flex;
      width: 100%;
      max-width: 1200px;
      gap: 20px;
    }

    .video-block {
      flex: 1;
    }

    iframe {
      width: 100%;
      height: 300px;
      border: none;
    }

    .edit-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      width: 100%;
      max-width: 1200px;
      margin-top: 20px;
    }

    .edit-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 30%;
    }

    .center-group {
      width: 30%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    input[type="text"], button, select, input[type="time"] {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      width: 100%;
      margin-bottom: 10px;
    }

    #saveBtn {
      margin-top: 25px;
      padding: 18px 35px;
      font-size: 22px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    #saveBtn:hover {
      background-color: #218838;
    }

    #resultat {
      text-align: center;
      margin-top: 15px;
      font-size: 16px;
      color: #ffd700;
    }

    @media (max-width: 900px) {
      .videos {
        flex-direction: column;
      }

      .edit-row {
        flex-direction: column;
        gap: 20px;
        align-items: center;
      }

      .edit-group, .center-group {
        width: 100%;
      }

      #saveBtn {
        width: 100%;
        max-width: 320px;
      }
    }
  </style>
</head>
<body>

  <h1>üß≠ Synchroniser deux POVs</h1>

  <div class="videos">
    <div class="video-block">
      <iframe id="videoA" src="https://www.youtube.com/embed/" allowfullscreen></iframe>
    </div>
    <div class="video-block">
      <iframe id="videoB" src="https://www.youtube.com/embed/" allowfullscreen></iframe>
    </div>
  </div>

  <div class="edit-row">
    <div class="edit-group">
      <input type="text" id="urlA" placeholder="Vid√©o √† synchroniser">
      <button onclick="changerVideo('videoA', 'urlA')">üîó Modifier gauche</button>
      <input type="text" id="timestampA" placeholder="Timestamp dans vid√©o A (ex: 01:52)">
    </div>

    <div class="center-group">
      <input type="text" id="jour" placeholder="Jour (ex: Jour 3)">
      <input type="time" id="heureIRL">
    </div>

    <div class="edit-group">
      <input type="text" id="urlB" placeholder="Vid√©o √©talon">
      <button onclick="changerVideo('videoB', 'urlB')">üîó Modifier droite</button>
      <input type="text" id="timestampB" placeholder="Timestamp dans vid√©o B (ex: 02:14)">
    </div>
  </div>

  <button id="saveBtn" onclick="synchroniser()">üíæ Enregistrer la synchronisation</button>
  <p id="resultat"></p>

  <script>
    function changerVideo(iframeId, inputId) {
      const url = document.getElementById(inputId).value;
      const videoId = extraireID(url);
      if (videoId) {
        document.getElementById(iframeId).src = "https://www.youtube.com/embed/" + videoId;
      } else {
        alert("Lien invalide ou non reconnu.");
      }
    }

    function extraireID(url) {
      const ytMatch = url.match(/(?:v=|\/embed\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
      return ytMatch ? ytMatch[1] : null;
    }

    function parseTime(str) {
      const [m, s] = str.split(":").map(Number);
      return m * 60 + s;
    }

    function formatHeure(totalSec) {
      const h = String(Math.floor(totalSec / 3600) % 24).padStart(2, '0');
      const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2, '0');
      const s = String(totalSec % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    function synchroniser() {
      const jour = document.getElementById("jour").value;
      const heureIRL = document.getElementById("heureIRL").value;
      const tsEtalonStr = document.getElementById("timestampB").value;
      const tsSyncStr = document.getElementById("timestampA").value;
      const urlA = document.getElementById("urlA").value;
      const urlB = document.getElementById("urlB").value;

      if (!jour || !heureIRL || !tsEtalonStr || !tsSyncStr || !urlA || !urlB) {
        alert("Veuillez remplir tous les champs.");
        return;
      }

      const tsEtalon = parseTime(tsEtalonStr);
      const tsSync = parseTime(tsSyncStr);
      const [h, m] = heureIRL.split(":").map(Number);
      const baseIRL = h * 3600 + m * 60;

      const delta = tsSync - tsEtalon;
      const irlSyncSec = baseIRL + delta;
      const irlSyncFinal = formatHeure(irlSyncSec);

      const syncData = {
        videoSync: urlA,
        videoEtalon: urlB,
        timestampSync: tsSyncStr,
        timestampEtalon: tsEtalonStr,
        irlEtalon: heureIRL + ":00",
        irlSync: irlSyncFinal,
        date_enregistrement: new Date().toISOString()
      };

      localStorage.setItem("sync_" + jour, JSON.stringify(syncData));
      document.getElementById("resultat").innerHTML = `
        ‚úÖ Synchronisation enregistr√©e pour ${jour}<br>
        üï∞Ô∏è Heure IRL estim√©e : <strong>${irlSyncFinal}</strong>
      `;
    }
  </script>

</body>
</html>
